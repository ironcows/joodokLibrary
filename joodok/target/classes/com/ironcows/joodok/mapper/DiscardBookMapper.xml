<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
          "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="com.ironcows.joodok.mapper.DiscardBookMapper">
	
	<!-- 폐기도서 1개 선택 -->
	<select id="getOneDiscardBook" parameterType="DiscardBook" resultType="DiscardBook">
		SELECT db.discardBookNo
			  ,db.bookDetailNo
			  ,db.librarianNo
			  ,db.registeredDate
			  ,db.modifiedDate
			  ,db.discardReason
		  FROM discardBook db
		 WHERE db.discardBookNo = #{discardBookNo}
	</select>
	
	
	<!-- 폐기도서 1개 등록 -->
	<insert id="insertDiscardBook" parameterType="DiscardBook">
		INSERT INTO discardBook(discardBookNo
							   ,bookDetailNo
							   ,librarianNo
							   ,registeredDate
							   ,discardReason)
				<!-- 없으면 YYMMDD0001 부터, 있으면 가장 최근 등록된 레코드의 값에서 자동으로 1씩 증가하게 하자 -->			   
		VALUES ((SELECT TO_CHAR(sysdate, 'YYMMDD')||NVL(LPAD(MAX(SUBSTR(d.discardBookNo, 7, 4))+1, 4, '0'), '0001')
			     FROM discardBook d
			    WHERE TO_CHAR(sysdate, 'YYMMDD') = SUBSTR(d.discardBookNo, 1, 6))
			   ,#{bookDetailNo}
			   ,#{librarianNo}
			   ,sysdate
			   ,#{discardReason})
	</insert>
	
</mapper>